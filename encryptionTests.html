<!DOCTYPE html>
<html>
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>
<label for="encryptionPassword">Encryption Password:</label>
<input type="password" id="encryptionPassword">
<button onclick="saveEncryptedData(encryptedData1)">Save Data</button>
<button onclick="loadEncryptedData()">Load Data</button>
<button onclick="deleteEncryptedData()">Delete Data</button>

<script>
    // Example encrypted data
    const encryptedData1 = {
        "privateKey": "wafdsfssdasdfas",
        "users": {
            "user1": {
                "site1": 0,
                "site2": 0
            },
            "user2": {
                "site1": 0,
                "site2": 0
            }
        }
    };

    const encryptedData2 = {
        "privateKey": "ASDFSADFSAD",
        "users": {
            "user3": {
                "site3": 0,
                "site4": 0
            },
            "user4": {
                "site5": 0,
                "site6": 0
            }
        }
    };

    // Hash the password
    function hashPassword(password) {
        return CryptoJS.SHA256(password).toString();

    }
    function loadEncryptedData() {
        const passwordInput = document.getElementById('encryptionPassword');
        if (!passwordInput) {
            console.error('Password input field not found in the DOM.');
            alert('An error occurred. Please reload the page and try again.');
            return;
        }

        const password = passwordInput.value.trim();
        if (!password) {
            alert('Please enter a password.');
            return;
        }

        try {
            const key = hashPassword(password); // Use the hashed password to retrieve the encrypted data
            const storedData = loadDictionary("encryptedDataStorage") || {}; // Load the dictionary

            if (!storedData || typeof storedData !== 'object') {
                alert('No stored data found or invalid data format.');
                return;
            }

            const encryptedData = storedData[key]; // Retrieve the encrypted data using the hashed key
            if (!encryptedData) {
                alert('No data found for the provided password.');
                return;
            }

            console.log('Encrypted data:', encryptedData);

            // Decrypt the data using the raw password
            const decryptedBytes = CryptoJS.AES.decrypt(encryptedData, password);
            const decryptedData = decryptedBytes.toString(CryptoJS.enc.Utf8);

            if (!decryptedData) {
                throw new Error('Failed to decrypt data. Possibly malformed UTF-8.');
            }

            console.log('Decrypted data:', decryptedData);
            alert('Data loaded successfully. Check console for details.');
            return JSON.parse(decryptedData); // Parse the JSON string back into an object
        } catch (error) {
            console.error('Error during decryption or parsing:', error.message);
            alert('Failed to decrypt. Invalid password or corrupted data.');
        }
    }

    function saveEncryptedData(dataToEncrypt) {
        const password = document.getElementById('encryptionPassword').value;
        if (!password) {
            alert('Please enter a password.');
            return;
        }

        const key = hashPassword(password); // Use the hashed password as the dictionary key
        const encrypted = CryptoJS.AES.encrypt(JSON.stringify(dataToEncrypt), password).toString(); // Encrypt with the raw password

        // Load existing dictionary from localStorage
        const existingData = loadDictionary("encryptedDataStorage") || {};
        existingData[key] = encrypted; // Save the encrypted data using the hashed password as the key
        saveDictionary("encryptedDataStorage", existingData); // Save back to localStorage
        console.log('Data saved with hashed key:', key);
    }


    // Load the entire dictionary from localStorage
    function loadDictionary(key) {
        const storedData = localStorage.getItem(key);
        if (storedData) {
            return JSON.parse(storedData); // Return parsed object
        } else {
            return {}; // Return empty object if nothing is found
        }
    }

    // Save the entire dictionary to localStorage
    function saveDictionary(key, dictionary) {
        localStorage.setItem(key, JSON.stringify(dictionary));
        console.log('Dictionary saved in localStorage.');
    }
function deleteEncryptedData(){
    localStorage.setItem("encryptedDataStorage", JSON.stringify({}));
    console.log("Encrypted Storage Deleted Succesfully")
}
    console.log(loadDictionary())
</script>
</body>
</html>
